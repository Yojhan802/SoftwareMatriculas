<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
    /* ============================================
       DEFINICIÃ“N DE VARIABLES TESLA (Scope Local)
       ============================================ */
    :root {
        --tesla-navy: #1a2332;
        --tesla-dark-blue: #0f1823;
        --tesla-sky-blue: #4fc3f7;
        --tesla-cyan: #00bcd4;
        --tesla-white: #ffffff;
        --tesla-light-gray: #f5f7fa;
        --tesla-success: #10b981;
        --tesla-danger: #ef4444;
        --tesla-warning: #f59e0b;
        --tesla-gradient-primary: linear-gradient(135deg, #1a2332 0%, #0f1823 100%);
        --tesla-gradient-accent: linear-gradient(135deg, #4fc3f7 0%, #00bcd4 100%);
        --tesla-shadow-sm: 0 2px 4px rgba(15, 24, 35, 0.1);
        --tesla-shadow-md: 0 4px 12px rgba(15, 24, 35, 0.15);
        --tesla-shadow-glow: 0 0 15px rgba(79, 195, 247, 0.3);
    }

    .tesla-card {
        background: var(--tesla-white);
        border-radius: 12px;
        border: none;
        box-shadow: var(--tesla-shadow-sm);
        border-top: 4px solid var(--tesla-cyan);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .tesla-card:hover {
        transform: translateY(-5px);
        box-shadow: var(--tesla-shadow-md);
    }

    .page-header-title {
        color: var(--tesla-navy);
        font-weight: 700;
        letter-spacing: -0.5px;
    }

    .table-container {
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid #eef2f7;
    }

    #tablaMatriculas thead th {
        background: var(--tesla-gradient-primary);
        color: var(--tesla-white);
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 1px;
        border: none;
        padding: 16px;
        font-weight: 600;
        vertical-align: middle;
    }

    #tablaMatriculas tbody tr {
        transition: all 0.2s ease-in-out;
        border-bottom: 1px solid #eef2f7;
    }

    #tablaMatriculas tbody tr:hover {
        background-color: rgba(79, 195, 247, 0.08) !important;
        transform: scale(1.002);
        z-index: 5;
        position: relative;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    #tablaMatriculas td {
        vertical-align: middle;
        font-size: 0.9rem;
        color: var(--tesla-navy);
        padding: 14px;
        font-weight: 500;
    }

    .form-control-tesla, .form-select-tesla {
        border-radius: 8px;
        border: 1px solid #e0e6ed;
        padding: 8px 15px;
        font-size: 0.9rem;
        transition: all 0.3s;
        color: var(--tesla-navy);
    }

    .form-control-tesla:focus, .form-select-tesla:focus {
        border-color: var(--tesla-sky-blue);
        box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.2);
        outline: none;
    }

    .input-group-text-tesla {
        background-color: #fff;
        border: 1px solid #e0e6ed;
        border-right: none;
        color: var(--tesla-cyan);
        border-top-left-radius: 8px;
        border-bottom-left-radius: 8px;
    }
    
    .btn-tesla-main {
        background: var(--tesla-gradient-accent);
        border: none;
        color: white;
        font-weight: 600;
        border-radius: 8px;
        box-shadow: var(--tesla-shadow-sm);
        transition: all 0.3s ease;
    }

    .btn-tesla-main:hover {
        transform: translateY(-2px);
        box-shadow: var(--tesla-shadow-glow);
        color: white;
        background: linear-gradient(135deg, #00bcd4 0%, #4fc3f7 100%);
    }

    .badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 700;
        font-size: 0.75rem;
        letter-spacing: 0.5px;
    }

    .badge.bg-success {
        background-color: rgba(16, 185, 129, 0.1) !important;
        color: var(--tesla-success) !important;
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .badge.bg-danger {
        background-color: rgba(239, 68, 68, 0.1) !important;
        color: var(--tesla-danger) !important;
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    .badge.bg-secondary {
        background-color: #f1f5f9 !important;
        color: #64748b !important;
        border: 1px solid #cbd5e1;
    }

    .btn-outline-primary {
        color: var(--tesla-cyan);
        border-color: var(--tesla-cyan);
        border-radius: 6px;
    }

    .btn-outline-primary:hover {
        background: var(--tesla-gradient-accent) !important;
        border-color: transparent !important;
        color: white !important;
        box-shadow: 0 0 10px rgba(0, 188, 212, 0.4);
    }

    .btn-outline-danger {
        color: var(--tesla-danger);
        border-color: var(--tesla-danger);
        border-radius: 6px;
    }

    .btn-outline-danger:hover {
        background-color: var(--tesla-danger) !important;
        color: white !important;
        box-shadow: 0 0 10px rgba(239, 68, 68, 0.4);
    }

    #tablaMatriculas tbody td button:has(.fa-pen),
    #tablaMatriculas .fa-pencil-alt {
        display: none !important;
    }
</style>

<div class="container-fluid animate__animated animate__fadeIn p-4">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-1 page-header-title">
                <i class="fas fa-list-alt me-2" style="color: var(--tesla-cyan);"></i>GestiÃ³n de MatrÃ­culas
            </h1>
            <p class="text-muted mb-0 small" style="border-left: 3px solid var(--tesla-cyan); padding-left: 10px;">
                Visualice y administre el historial acadÃ©mico de los alumnos.
            </p>
        </div>
        <button class="btn btn-tesla-main btn-lg px-4 py-2" onclick="loadViewOriginal('Matriculas/matriculas.html')">
            <i class="fas fa-plus-circle me-2"></i> Nueva MatrÃ­cula
        </button>
    </div>

    <div class="card tesla-card mb-4">
        <div class="card-body p-4">
            <div class="row mb-4 align-items-end g-3">
                <div class="col-md-2 col-sm-12">
                    <label class="small text-muted fw-bold mb-1">Mostrar</label>
                    <select class="form-select form-select-tesla" id="elementosPorPagina" onchange="aplicarFiltrosLocales()">
                        <option value="10">10 registros</option>
                        <option value="25">25 registros</option>
                        <option value="50">50 registros</option>
                    </select>
                </div>

                <div class="col-md-3 col-sm-12">
                    <label class="small text-muted fw-bold mb-1">Estado</label>
                    <select class="form-select form-select-tesla" id="filtroEstadoMatricula" onchange="aplicarFiltrosLocales()">
                        <option value="TODOS">Todos los Estados</option>
                        <option value="ACTIVO" selected>ðŸ”µ Solo Activos</option>
                        <option value="ANULADO">âšª Solo Anulados</option>
                    </select>
                </div>

                <div class="col-md-7 col-sm-12">
                    <label class="small text-muted fw-bold mb-1">BÃºsqueda Inteligente</label>
                    <div class="input-group">
                        <span class="input-group-text input-group-text-tesla">
                            <i class="fas fa-search"></i>
                        </span>
                        <input type="text" class="form-control form-control-tesla border-start-0 ps-2" 
                               id="inputBusquedaMatricula" 
                               placeholder="Buscar por nombre (mÃ¡x 30) o DNI (8 dÃ­gitos)..." 
                               maxlength="30"
                               oninput="validarEntradaBusqueda(this)"
                               onkeyup="aplicarFiltrosLocales()">
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table class="table mb-0" id="tablaMatriculas" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th style="width: 5%">ID</th>
                            <th style="width: 20%">Alumno</th>
                            <th style="width: 15%">DNI</th>
                            <th style="width: 10%">Fecha</th>
                            <th style="width: 5%">Periodo</th>
                            <th style="width: 10%">Nivel</th>
                            <th style="width: 15%">Grado</th>
                            <th style="width: 10%">Monto</th>
                            <th style="width: 10%">Estado</th>
                            <th style="width: 5%" class="text-center">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cuerpoTablaMatriculas">
                        <tr>
                            <td colspan="10" class="text-center py-5">
                                <div class="spinner-border text-info" style="width: 3rem; height: 3rem;" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-3 text-muted fw-bold">Sincronizando datos...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="row mt-4 align-items-center">
                <div class="col-md-5 text-muted small" id="infoRegistros">
                    <i class="fas fa-info-circle me-1 text-info"></i> Mostrando registros del sistema
                </div>
                <div class="col-md-7">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-end mb-0 pagination-sm" id="paginacionMatriculas">
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    if (typeof listarMatriculas === 'function') {
        listarMatriculas();
    }
</script>